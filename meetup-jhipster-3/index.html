<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>JHipster Meetup Presentation</title>

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
			<div class="slides">
                <section>
					<br/><br/>
					<h2>Who are we ?</h2>
				<div style="float:left">
					<img src="img/1577727.jpeg" width="150"/>
					<h3>William Marques</h3>
                    <p>@wylmarq</p>
					<p>JHipster Intern</p>

				</div>
				<div style="float:right">
					<img src="img/513471.jpeg" width="150"/>
					<h3>Pierre Besson</h3>
					<p>@pibesson</p>
					<p>JHipster Intern</p>
				</div>

				</section>
				<section>
					<h4>Microservices, Gateway, Registry, Dashboards , ...</h4>
					<h3><i class="fa fa-sitemap"></i> + <i class="fa fa-book"></i> + <i class="fa fa-tachometer"></i></h3>
					<h2>How do I run all these apps ?</h2>
					<h1><i class="fa fa-puzzle-piece"></i></h1>
				</section>

				<section>
					<h2>jhipster:docker-compose</h2>
					<p>
						A <strong>JHipster</strong> subgenerator.
					</p>
                    <p>
                        <img height="30%" width="30%" data-src="img/docker-compose.png" alt="" />
                    </p>

				</section>

                <section>
                    <section>
                        <h2>What does it do ?</h2>

                    </section>
                    <section>
                        <p>
                            Get all the necessary YAML files into <strong>ONE</strong> docker-compose YAML
                        </p>
                        <p>
                            So you can easily run all the necessary applications :
                            <ul>
                                <li>Applications</li>
                                <li>Databases</li>
                                <li>Registry</li>
                                <li>Monitoring</li>
                            </ul>
                        </p>

                    </section>
                </section>

				<section>
                    <section>
                        <h2>How does it works ?</h2>
                        <img height="30%" width="30%" data-src="img/pug-head-tilt-o.gif" alt="" />
                    </section>

                    <section>
                        Let's begin with this setup:
                        <ul>
                            <li>A gateway</li>
                            <li>A microservice with a mySQL database</li>
                            <li>A microservice with a mongoDB database</li>
                        </ul>
                    </section>

                    <section>
                        <p>
                            To run all this without the subgenerator, we would need to :
                            <ul>
                                <li>Go into each folder</li>
                                <li>Launch each container one by one</li>
                                <li>Create a shared config file (to share the JWT token)</li>
                                <li>Launch the registry container</li>
                            </ul>
                        </p>
                        <p>
                            It would be about <strong>5</strong> terminal tabs and <strong>alot</strong> of time...
                        </p>
                        <img  data-src="img/sadcat.gif" alt="" />

                    </section>

                    <section>
                        <p>Let's create a directory aside of our apps and run</p>
                        <pre><code data-trim class="sh">
mkdir docker-config
cd docker-config
jhipster:docker-compose
                        </code></pre>
                    </section>

                    <section>
                        <h2>Let's run everything with one command</h2>
                        <pre><code data-trim class="sh">
                        docker-compose up -d
                        </code></pre>
                        <img  data-src="img/kanye.gif" alt="" />
                    </section>
				</section>

                <section>
                    <section>
                        <h2>Want to scale ?</h2>
                        <img  data-src="img/scale.gif" alt="" />
                    </section>
                    <section>
                        <h2>How to scale a microservice</h2>
                        <pre><code data-trim class="sh">
                            docker-compose scale ms-app=3
                        </code></pre>
                    </section>
                    <section>
                        <h2>How to scale a database</h2>
                        <p>
                            Only available with Cassandra and MongoDB databases.
                        </p>
                        <p>
                            We are going to scale our MongoDB database:
                            <ul>
                                <li>Use the cluster mode of MongoDB</li>
                                <li>Scale the node service</li>
                                <li>Initiate a replicaset of X node</li>
                                <li>Register the shard into the router service (mongos)</li>
                                <li>Relaunch our application</li>
                            </ul>
                        </p>
                    </section>
                </section>


	<section>
		<section data-markdown>
			<script type="text/template">
				### Monitoring a JHipster microservice architecture
				##<i class="fa fa-line-chart"></i>
				<span style="float:left">What do we want to do ?</span>
				* Centralize and analyse all your apps logs and metrics
				* Be able to index and search logs
				* Display metrics in real time graphs
				* Have some level of interactivity in our dashboards <!--refine the selection -->
			</script>
		</section>
		<section data-markdown>
			<!--
			The ELK stack is composed of:

			Elasticsearch for indexing the data (logs and metrics)
			Logstash to manage and process the logs received from the applications
			Kibana to visualize the logs with a nice interface
			-->
			<script type="text/template">
			<img data-src="img/console.svg" alt="" style="border:none" width="40%"/>

			<div class="fragment">Monitoring and Alerting tool based on the ELK stack
				<img data-src="img/elk-logo.png" alt="" style="border:none" width="45%"/>
				<img data-src="img/docker+metrics.png" alt="" style="border:none" width="23%"/>
			</div>

			<ul>
			<span class="fragment"><li>Monitor logs and metrics of your monolith and microservice apps</li></span>
			<span class="fragment"><li>Define alerting rules to be notified when anolies are detected (provided by the **Elastalert** tool from Yelp)</li></span>
			<span class="fragment"><li>Can be customized and extended to suit your needs</li></span>
			</script>
			<aside>

			</aside>
		</section>
		<section data-markdown>
			<script type="text/template">
				### Getting started with JHipster monitoring
Forward logs and metrics to logstash

```
jhipster:
	logging:
		logstash:
			enabled: true
			host: localhost
		metrics:
			logs:
				enabled: true
				reportFrequency: 60 # seconds
```
Get the compose file and start **JHipster-Console**, **Elasticsearch** and **Logstash**:
<!--
curl -o conf/logstash.conf https://raw.githubusercontent.com/jhipster/jhipster-console/master/log-monitoring/log-config/logstash.conf
curl -o docker-compose.yml https://raw.githubusercontent.com/jhipster/jhipster-console/master/boostrap/docker-compose.yml
-->
```
docker-compose up -d
```
			</script>
		</section>
		<section data-markdown>
			<script type="text/template">
				# DEMO
			</script>
		</section>
	</section>

<section>
	<section data-markdown>
		<script type="text/template">
			### Centralized Configuration with JHipster and Spring Cloud Config
			<p><i class="fa fa-leaf"></i> + <i class="fa fa-cloud"></i> + <i class="fa fa-cogs"></i></p>
			<ul><span class="fragment"><li> Deal with the complexity of managing multiples services configuration</li></span>
			<span class="fragment"><li> Externalize applications configuration (12 factor)</li></span>
			<span class="fragment"><li> Define configurations for specific profiles (dev, prod)</li></span>
			<span class="fragment"><li> Put the configuration under version control</li></span>
			<span class="fragment"><li> Bonus: refresh configuration without restarting the app</li></span></ul>
		</script>
	</section>

	<section data-markdown>
		<script type="text/template">
			### How does it works ?

			<ul><span class="fragment"><li> On startup, applications query the **configuration server** and overwrite local properties with the remote ones</li></span>
			<div class="fragment">
			<li> Properties are regular Spring Boot properties:
				<div class="fragment">
				<ul>
				<li> Typed, defined with a key-value format (.properties, .yml)</li>
				<li> Defined in **@ConfigurationProperties** classes</li>
				<li> Properties can be profile specific </li><!--application.yml, application-dev.yml replaced extended  -->
				<li> Several profiles can be used at the same time</li>
				<ul>
				</div>
			</li>
		</div>
		</script>
	</section>

	<section data-markdown>
		<script type="text/template">
			### Use the Configuration Server
			How do I define externalized properties for my services ?

			<span style="font-size:95%" class="fragment"><i class="fa fa-arrow-right"></i> Simply add regular property files in your configuration source</span>
			<div class="fragment">
			`gateway.yml`
			```
			property.foo: Hello JHipster Meetup !
			```
			`gateway-dev.yml`
			```
			server.port: 8080
			property.foo: Hello dev
			```
			`gateway-prod.yml`
			```
			server.port: 80
			property.foo: Hello prod
			```
		</script>
	</section>

	<section data-markdown>
		<script type="text/template">
		### Configurations sources
		- <i class="fa fa-file-text-o"></i> File based  (for development)
		- <i class="fa fa-code-fork"></i> Git based (for production)

	<p><i class="fa fa-arrow-circle-right"></i> Load from a git repo (_file://_, _https://_ or _ssh://_)</p>
	<p><i class="fa fa-arrow-circle-right"></i> Persists the config on the clients</p>
	<p><i class="fa fa-arrow-circle-right"></i> Tag the config (using _branches_ or _commit ids_)</p>
	</script>
	</section>

	<section data-markdown>
		<script type="text/template">
		# DEMO
		<!-- config server demo, sample property with a rest controller, dev, prod, hot refresh -->
	</script>
	</section>
</section>

<section>
	<section data-markdown data-transition="none">
		<script type="text/template" >
	### Feature Toggling <i class="fa fa-toggle-off"></i>
	### with JHipster microservices
		</script>
	</section>
	<section data-markdown data-transition="none">
		<script type="text/template">
	### Feature Toggling <i class="fa fa-toggle-on"></i>
	### with JHipster microservices
		</script>
	</section>
	<section data-markdown >
		<script type="text/template">
	### Feature Toggling <i class="fa fa-toggle-on"></i>
	### with JHipster microservices
	* **Goal:** Safely replace an existing functionality with no downtime
	* **Problem:** Our architecture is distributed !<!-- so it's not just a matter of wrapping new code in a big "if"-->

	<blockquote style="width:100%">
		<p style="float:left"> Feature toggling can be used for:</p>
	<ul><li> **Canary releasing:** turn the new feature for _N%_ of users</li>
	<li> **A/B testing:**  turn on the feature for a control group and study their behavior</li>
	</ul>
	</blockquote>
		<!-- feature toggling demo, refreshing zuul routing -->
	</script>
	<aside>
		* Safely replace an existing functionality with no downtime
		* have several version of the same feature available at the same time
	</aside>
	</section>
    </section>
				<section style="text-align: left;">
					<h1>Thank You !</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                slideNumber:true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>
	</body>
</html>
